<?xml version="1.0" encoding="windows-1251" ?>

<!DOCTYPE page [
<!ENTITY nbsp "&#160;">
<!ENTITY пробел "&#160;">
<!ENTITY shy "&#173;">
<!ENTITY перенос "&#173;">
]>

<?xml:stylesheet type="text/xsl" href="../common/layout.xsl" ?>

<Урок xmlns="x-schema:Schema.xml" название="MySQL" предыдущий="section02.xml" следующий="section04.xml">
<h2>Проверка таблиц на наличие ошибок</h2>
<h3>Блокировка таблиц для выполнения проверки </h3>
<P>
Описанную ниже процедуру можно применять
только для проверки таблиц, но не их исправления. В окне 1 запустите mysql и выполните следующие операторы:
 <pre>c:\mysql\bin&gt; mysql db_name mysql&gt; LOCK TABLE  tbl_name  READ
mysql&gt; FLUSH TABLES </pre>
Установленная таким образом блокировка запретит
другим клиентам запись данных в таблицу и их изменение в процессе проверки. Оператор FLUSH дает указание серверу закрыть файлы таблиц, чтобы внести все изменения, которые еще не записаны в файл, но уже кэшированы. Не завершая работы mysql, переключитесь
в окно 2 и запустите процесс проверки таблиц:
  
</P>    

<H3>Синтаксис утилит myisamchk и isamchk</H3>
<P>Утилиты myisamchk и isamchk во многом подобны и в большинстве случаев 
используются в одинаковом аспекте. Основное различие между ними заключается в 
типе таблиц, к которым применяются эти утилиты. Для таблиц MylSAM применяется 
утилита myisamchk, а для таблиц ISAM — isamchk. Используемый в таблице формат 
хранения данных можно определить по расширению имени файла индекса таблицы. 
Расширение MYI соответствует таблице MylSAM, а расширение ISM — таблице ISAM. 
Для использования любой из этих утилит укажите в строке запуска, какие таблицы 
необходимо проверить или восстановить, я также опции, отражающие тип выполняемой 
операции:</P>
<PRE> c:\mysql\bin&gt; myisamchk options tbl_name ...
 c:\mysql\bin&gt; isamchk options tbl_name ... </PRE>
<P>            
 В качестве аргумента tbl_name может выступать как имя 
таблицы, так и имя файла ее индекса. Чтобы определить имена сразу 
нескольких таблиц определенного каталога, можно воспользоваться следующим синтаксисом: </P>
<PRE> c:\mysql\bin&gt; myisamchk options *.MYI 
 c:\mysql\bin&gt; isamchk options *.ISM </PRE>
<P>          
  Запуск неправильной программы для проверки 
не приведет к повреждению таблицы, однако и не приведет 
к каким-либо положительным результатам, кроме вывода предупреждения. Так, например, выполнение-первого из 
двух следующих операторов приведет к проверке всех таблиц MylSAM в текущем 
каталоге, в то время как при запуске второго появится сообщение об 
ошибке. </P>
<PRE>c:\mysql\bin&gt; myisamchk *.MYI. Правильно. 
c:\mysql\bin&gt; myisamchk *. ISM. Неправильно — неверный тип файла. </PRE>
<P><EM>Утилиты myisamchk и isamchk не в состоянии 
самостоятельно определить местоположение файлов таблиц, поэтому необходимо либо 
запускать их непосредственно в каталоге с файлами таблиц, либо явным образом 
указывать путь к этим файлам.</EM>       
     Такой подход позволяет легко копировать файлы 
таблиц в другой каталог, а затем проверять и исправлять их копии.</P> 
<h3>Проверка таблиц </h3>
<P>Утилиты myisamchk и isamchk обеспечивают несколько методов проверки таблиц, 
отличающихся в основном детализацией. Как правило, вполне достаточно нормального 
метода проверки. Если же даже после ее выполнения сообщения об ошибке не 
отображаются, но администратор&nbsp;подозревает наличие повреждений (возможно, 
потому что неправильно&nbsp;обрабатываются запросы), можно выполнить более 
детальную проверку. Для выполнения нормальной проверки достаточно вызвать 
соответствующую утилиту без всяких опций:</P>
<IMG src ="./chk.png" alt="Команда myisamchk"/>
<P>Для запуска более детальной проверки используется опция --extend-check. 
Процедура детальной проверки может затянуться надолго, однако выполняется она 
чрезвычайно досконально: проверяется каждая запись файла данных таблицы, ключ 
для каждого индекса файла индексов, чтобы убедиться, что он указывает на 
правильную запись. Утилита myisamchk имеет еще одну опцию, --medium-check, 
которая приводит к выполнению менее тщательной, но более быстрой проверки. </P>
<P>Если после проверки с помощью опции --extend-check на экране не появляется 
сообщение об ошибке, можно с полной уверенностью сказать, что с таблицей все в 
порядке. Поэтому проблемы с выполнением запросов к ней наверняка лежат в другой 
плоскости. Внимательно исследуйте текст всех запросов, выводящих неправильные 
результаты, и убедитесь, что они написаны корректно. Если проблема связана с 
сервером MySQL, попробуйте поискать подобную ошибку в отчете об ошибках и 
обновить свою версию сервера. Если же утилиты myisamchk и isamchk сообщают о 
наличии в таблице ошибок, их следует устранить. Для этого необходимо выполнить 
действия описанные в&nbsp;разделе&nbsp; "Восстановление таблиц".</P><p>По   завершении работы  утилит   снова
переключитесь на сеанс работы mysql окна 1 и снимите блокировку: 
<pre>mysql&gt; UNLOCK TABLE </pre>Если утилиты myisamchk 
или isamchk сообщают о наличии определенных ошибок в таблице, самое время 
приступить к их исправлению.  </p>
		
</Урок>
